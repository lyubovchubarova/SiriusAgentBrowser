Техническая документация Sirius Agent Browser

1. Architecture Decision Records (ADR)

ADR-001: Модульная архитектура системы
Контекст:
При проектировании агента необходимо было создать систему, которая могла бы гибко развиваться и поддерживать различные модели ИИ.
Решение:
Мы приняли решение разделить систему на четыре основных независимых модуля:
1. Orchestrator (Оркестратор)  центральный компонент, управляющий потоком выполнения.
2. Planner (Планировщик)  модуль, отвечающий за высокоуровневое планирование действий на основе LLM.
3. VLM (Vision Language Model Agent)  модуль, отвечающий за визуальное восприятие интерфейса и выполнение низкоуровневых действий.
4. Browser Controller  модуль для непосредственного взаимодействия с браузером.
Обоснование:
Такое разделение позволяет нам заменять отдельные компоненты без переписывания всей системы. Например, мы можем заменить модель планирования с GPT-4o на YandexGPT, изменив только класс Planner. Это также упрощает тестирование и отладку, так как каждый модуль можно тестировать изолированно.

ADR-002: Использование фреймворка FastAPI
Контекст:
Нам нужен был веб-сервер для обработки запросов от расширения Chrome и управления агентом.
Решение:
Мы выбрали FastAPI в качестве основного веб-фреймворка.
Обоснование:
FastAPI обеспечивает высокую производительность и нативную поддержку асинхронности (async/await). Это критически важно для нашего агента, так как операции взаимодействия с LLM и браузером могут занимать длительное время. Асинхронность позволяет серверу не блокироваться во время ожидания ответа от нейросети. Кроме того, FastAPI автоматически генерирует документацию Swagger, что упрощает разработку API.

ADR-003: Пользовательский интерфейс через Chrome Extension
Контекст:
Пользователю нужен удобный способ взаимодействия с агентом прямо в браузере.
Решение:
Мы реализовали интерфейс в виде расширения для Google Chrome, использующего Side Panel API.
Обоснование:
Боковая панель (Side Panel) позволяет пользователю видеть чат с агентом и одновременно наблюдать за веб-страницей, с которой работает агент. Это создает бесшовный пользовательский опыт. Расширение также имеет доступ к вкладкам браузера, что упрощает передачу контекста (URL, скриншоты) на сервер.

ADR-004: Использование Playwright для автоматизации
Контекст:
Необходим инструмент для программного управления браузером.
Решение:
Мы выбрали Microsoft Playwright вместо Selenium или Puppeteer.
Обоснование:
Playwright работает быстрее и стабильнее, чем Selenium. Он имеет встроенную поддержку ожидания элементов, что уменьшает количество ошибок "элемент не найден". Важным фактором стала поддержка протокола Chrome DevTools Protocol (CDP), который необходим для получения расширенной информации о странице и выполнения низкоуровневых команд.

2. API Спецификация

Сервер приложения запускается локально на порту 8000. Взаимодействие происходит по протоколу HTTP с использованием формата JSON.

Эндпоинт: POST /chat
Описание:
Этот метод используется для отправки нового задания агенту или продолжения диалога.
Параметры запроса (Body):
- query (строка, обязательно): Текст запроса пользователя. Например: "Забронируй отель в Москве".
- chat_history (список объектов, опционально): История предыдущих сообщений для поддержания контекста диалога.
Ответ сервера:
Сервер возвращает JSON-объект, содержащий статус приема задачи. Обработка происходит асинхронно, поэтому результат выполнения не возвращается мгновенно в этом ответе.

Эндпоинт: GET /stream
Описание:
Этот метод реализует протокол Server-Sent Events (SSE). Клиент (расширение) подписывается на этот поток для получения обновлений в реальном времени.
Формат данных:
Сервер отправляет события в формате text/event-stream. Каждое сообщение содержит JSON с полями:
- type: Тип события (например, "status", "log", "result", "error").
- content: Содержимое события (текст статуса, лог действия или финальный ответ).
Пример потока данных:
data: {"type": "status", "content": "Анализирую страницу..."}
data: {"type": "log", "content": "Перехожу на сайт aviasales.ru"}

Эндпоинт: POST /stop
Описание:
Метод для экстренной остановки выполнения текущей задачи агента.
Действие:
При вызове этого метода Оркестратор получает сигнал остановки и прерывает цикл выполнения после завершения текущего шага.

Эндпоинт: GET /health
Описание:
Используется для проверки работоспособности сервера (Health Check).
Ответ:
Возвращает JSON {"status": "ok"}. Расширение периодически опрашивает этот эндпоинт, чтобы показать пользователю индикатор подключения (зеленый или красный).

3. Deployment Guide (Руководство по развертыванию)

Системные требования:
Операционная система: Windows 10 или 11, macOS (на процессорах Intel или Apple Silicon), современные дистрибутивы Linux (Ubuntu 20.04+).
Программное обеспечение:
- Python версии 3.10 или новее.
- Браузер Google Chrome последней версии.
- Git для клонирования репозитория.

Пошаговая инструкция по установке:

Шаг 1. Получение исходного кода
Откройте терминал и выполните команду клонирования репозитория:
git clone https://github.com/lyubovchubarova/SiriusAgentBrowser.git
Затем перейдите в папку проекта:
cd SiriusAgentBrowser

Шаг 2. Настройка переменных окружения
В корне проекта найдите файл .env.example. Скопируйте его и переименуйте в .env.
Откройте файл .env в текстовом редакторе и укажите ваши API ключи:
- YANDEX_CLOUD_API_KEY: Ваш API ключ от Yandex Cloud.
- YANDEX_CLOUD_FOLDER: Идентификатор вашего каталога в Yandex Cloud.
- OPENAI_API_KEY: (Опционально) Ключ от OpenAI, если вы планируете использовать модели GPT-4.
- HEADLESS: Установите false, чтобы видеть окно браузера, или true для работы в фоновом режиме.

Шаг 3. Установка зависимостей Python
Рекомендуется использовать виртуальное окружение.
Создайте окружение: python -m venv venv
Активируйте его:
- Windows: .\venv\Scripts\activate
- Linux/macOS: source venv/bin/activate
Установите необходимые библиотеки:
pip install -r requirements.txt
Установите браузеры для Playwright:
playwright install

Шаг 4. Запуск приложения
Для удобства мы подготовили скрипты автоматического запуска.
Пользователи Windows:
Запустите файл start_agent.bat двойным кликом.
Пользователи Linux и macOS:
Дайте права на выполнение скрипту: chmod +x start_agent.sh
Запустите скрипт: ./start_agent.sh

Скрипт выполнит следующие действия:
1. Запустит Google Chrome с параметром удаленной отладки на порту 9222.
2. Запустит сервер агента на порту 8000.

4. Troubleshooting Guide (Устранение неполадок)

Проблема: Ошибка "Browser not found" или "Connection refused"
Причина: Агент не может подключиться к браузеру Chrome.
Решение:
Убедитесь, что вы полностью закрыли все окна Chrome перед запуском скрипта. Агент должен сам запустить браузер со специальными флагами. Проверьте, что порт 9222 свободен. Если вы запускаете Chrome вручную, обязательно добавьте флаг --remote-debugging-port=9222.

Проблема: Агент долго думает и ничего не делает
Причина: Возможно, проблема с подключением к API языковой модели (LLM).
Решение:
Посмотрите в консоль, где запущен сервер. Если вы видите ошибки таймаута или ошибки авторизации (401, 403), проверьте правильность API ключей в файле .env. Убедитесь, что у вас есть средства на балансе облачного провайдера.

Проблема: В расширении горит красный индикатор статуса
Причина: Расширение не может связаться с локальным сервером.
Решение:
1. Убедитесь, что сервер запущен (окно консоли открыто и нет ошибок).
2. Откройте в браузере адрес http://localhost:8000/health. Вы должны увидеть {"status": "ok"}.
3. Если сервер работает, попробуйте перезагрузить расширение: зайдите в chrome://extensions, найдите Sirius Agent и нажмите значок обновления.

Проблема: Агент кликает не туда
Причина: Визуальная модель (VLM) может ошибаться при определении координат на сложных сайтах.
Решение:
Попробуйте переформулировать запрос. Иногда помогает изменение масштаба страницы или разворачивание окна браузера на весь экран.

5. User Documentation (Документация пользователя)

Как использовать агента:
1. Убедитесь, что сервер и браузер запущены (см. раздел Запуск).
2. В браузере Chrome нажмите на значок "Пазл" (Расширения) и выберите Sirius Agent Browser. Откроется боковая панель.
3. В нижней части панели находится поле ввода. Напишите вашу задачу естественным языком.
Пример: "Зайди на сайт погоды и скажи, какая температура в Санкт-Петербурге".
4. Нажмите Enter или кнопку отправки.
5. Агент начнет работу. В чате будут появляться сообщения о его действиях ("Ищу в Google...", "Перехожу на сайт...", "Читаю содержимое...").
6. Вы увидите, как в основном окне браузера происходят действия: прокрутка, клики, ввод текста. Не вмешивайтесь в работу мыши и клавиатуры в этот момент.
7. По завершении задачи агент пришлет финальный ответ в чат.

Примеры типовых задач:
Поиск и агрегация информации:
"Найди 3 самых популярных модели роботов-пылесосов на Яндекс.Маркете, сравни их цены и напиши краткий отчет."
Навигация и взаимодействие:
"Зайди на youtube.com, найди канал 'Научпок' и открой последнее видео."
Работа с формами:
"Перейди на сайт генератора паролей, сгенерируй сложный пароль длиной 16 символов и скопируй его в чат."

Часто задаваемые вопросы (FAQ):

Вопрос: Может ли агент решать капчи (CAPTCHA)?
Ответ: Агент использует визуальные модели, которые могут распознать простые текстовые капчи или выбрать нужные картинки (например, "найдите светофоры"). Однако сложные интерактивные капчи или слайдеры могут вызвать затруднения. В таких случаях агент может попросить вас помочь и решить капчу вручную.

Вопрос: Безопасно ли доверять агенту пароли?
Ответ: Агент работает локально на вашем компьютере, и ваши данные не отправляются третьим лицам (кроме обезличенных запросов к LLM). Тем не менее, мы не рекомендуем использовать агента для входа в критически важные аккаунты (интернет-банк, госуслуги) в автоматическом режиме, так как поведение нейросети может быть непредсказуемым.

Вопрос: Почему агент иногда ошибается?
Ответ: Технология автономных агентов все еще находится в стадии активного развития. Модели могут "галлюцинировать" или неправильно интерпретировать сложные элементы интерфейса. Мы постоянно работаем над улучшением точности.

Ограничения и лучшие практики:
- Скорость работы: Агент работает медленнее человека, так как ему нужно время на "обдумывание" каждого шага (отправку скриншота, получение ответа от модели).
- Контекст: Агент имеет ограниченную память. Если задача требует посещения десятков страниц, он может "забыть" начало. Лучше разбивать большие задачи на цепочку мелких.
- Сложные интерфейсы: Сайты с нестандартной версткой (Canvas, сложные SPA) могут быть трудны для анализа.

6. Дополнительная информация

Общая идея проекта:
Мы создаем цифрового помощника, который освобождает человека от рутины в интернете. Представьте, что у вас есть стажер, который сидит за вашим компьютером и делает то, что вы ему говорите. Sirius Agent Browser  это именно такой стажер. В отличие от обычных скриптов автоматизации, которые ломаются при малейшем изменении дизайна сайта, наш агент "смотрит" на сайт глазами и адаптируется к изменениям.

Архитектура проекта (Гибридный подход):
Уникальность нашего решения заключается в комбинации двух типов искусственного интеллекта:
1. LLM (Large Language Model)  отвечает за стратегическое планирование. Она понимает цель пользователя ("Купить билеты") и разбивает ее на шаги ("Открыть сайт", "Выбрать даты", "Нажать поиск").
2. VLM (Vision Language Model)  отвечает за тактическое выполнение. Она получает скриншот страницы и находит на нем нужные элементы ("Кнопка 'Поиск' находится по координатам X:100, Y:200").
Такой подход позволяет достичь высокой надежности: планировщик не дает агенту сбиться с пути, а визуальная модель позволяет взаимодействовать с любым интерфейсом, даже если у него нет четкой структуры кода.

Дополнительные возможности:
- Темная тема: Интерфейс расширения автоматически подстраивается под тему вашей системы или может быть переключен вручную. Это снижает нагрузку на глаза при работе в темное время суток.
- Интеграция с заметками (В разработке): Мы работаем над функцией, которая позволит агенту не просто выводить ответ в чат, а создавать структурированные заметки в Notion или сохранять файлы на диск.
- Голосовое управление (В планах): В будущих версиях вы сможете просто сказать агенту, что нужно сделать, не используя клавиатуру.
